#!/bin/rc
## Adds commands to acme tag, depending on file type

rfork e

# add WINID TEST TEXT
fn add{
	cat $1/tag | grep $2 >/dev/null || echo -n $3 >$i/tag
}

cd /mnt/acme
for (i in [0-9]*){
	if(test -d $i){
		tag=`{cat $i/tag}
		file=$tag(1)

		switch($file){
		case *.[ch]
			add $i '\|a-' '|a- // |a+ //'
		case *.go
			add $i 'Lcomp' 'Lcomp Ldef Lrefs Limpls Ltype Lrn'
		case *
			## No extension, we check for shebang
			if(! ~ $file */ *+Errors* */-* */lib/guide *')'){
				interp=`{sed 1q <$i/body}
				switch($interp){
				case */rc
					add $i '\|a-' '|a- ''#'' |a+ ''#'''
				}
			}
		}
	}
}
status=''
